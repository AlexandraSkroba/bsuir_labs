import numpy as np
# –ó–∞–¥–∞—á–∞ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî —ç—Ç–æ —Ç–∏–ø –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏,
# —Ü–µ–ª—å –∫–æ—Ç–æ—Ä–æ–π —Å–æ—Å—Ç–æ–∏—Ç –≤ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ (–∏–ª–∏ –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏) –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–π —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º –ª–∏–Ω–µ–π–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

#1) –ú–∞—Ç—Ä–∏—Ü–∞ D —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–π, –µ—Å–ª–∏ –æ–Ω–∞ —Ä–∞–≤–Ω–∞ —Å–≤–æ–µ–π —Ç—Ä–∞–Ω—Å–ø–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–∞—Ç—Ä–∏—Ü–µ
#2) –ú–∞—Ç—Ä–∏—Ü–∞ D –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ª—É–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π, –µ—Å–ª–∏ –¥–ª—è –ª—é–±–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞ x, –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ ùë• ‚Ä≤ùê∑ x >= 0
# –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ
#3) –ö–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞—è —Ñ–æ—Ä–º–∞ ‚Äî —ç—Ç–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–∞ ùëÑ ( ùë• ) = 1/2 2),
# –≠—Ç–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —É–¥–≤–æ–µ–Ω–Ω—É—é —Å—É–º–º—É –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Ç—Ä–∏—Ü—ã D
# –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–µ–∫—Ç–æ—Ä–∞ x' - –≤–µ–∫—Ç–æ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

#4) –î–æ–ø—É—Å—Ç–∏–º—ã–π –ø–ª–∞–Ω x –∑–∞–¥–∞—á–∏ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º- –º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è  –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º  –æ–ø–æ—Ä–Ω—ã–º  –ø–ª–∞–Ω–æ–º,
# –µ—Å–ª–∏  —Å—É—â–µ—Å—Ç–≤—É- –µ—Ç –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ Jb –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö {1, 2, . . . , n} —Ç–∞–∫–æ–µ, —á—Ç–æ

# —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –±–∞–∑–∏—Å–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞ —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
def get_basis_vector(c, B):
    i = 0
    c_b = [0 for _ in B]
    for index in B:
        c_b[i] = c[index]
        i += 1
    return c_b


# —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ—à–µ–Ω–∏—è
def check(delta_x):
    for i in range(len(delta_x)):
        if delta_x[i] < 0:
            return i
    return -1


if __name__ == "__main__":
    c = np.array([-8, -6, -4, -6]) # –í–µ–∫—Ç–æ—Ä —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
    A = np.array([[1, 0, 2, 1],
                  [0, 1, -1, 2]])
    x = np.array([2, 3, 0, 0]) # –ø—Ä–∏–∞–≤–ª—å–Ω—ã–π –æ–ø–æ—Ä–Ω—ã–π –ø–ª–∞–Ω
    B = np.array([0, 1]) # –ò–Ω–¥–µ–∫—Å—ã –±–∞–∑–∏—Å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    Bs = np.array([0, 1]) # –ò–Ω–¥–µ–∫—Å—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –æ–ø–æ—Ä—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
    D = np.array([[2, 1, 1, 0],
                  [1, 1, 0, 0],
                  [1, 0, 1, 0],
                  [0, 0, 0, 0]])
    counter = 0
    print('----–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏---')
    print('–ú–∞—Ç—Ä–∏—Ü–∞ A: ', A, sep='\n')
    print('–ú–∞—Ç—Ä–∏—Ü–∞ D: ', D, sep='\n')
    print('–í–µ–∫—Ç–æ—Ä B: ', B, sep='')
    print('–í–µ–∫—Ç–æ—Ä —Å: ', c, sep='')
    print('–í–µ–∫—Ç–æ—Ä x: ', x, sep='')
    while True:
        counter += 1
        print(f'\n----------–ò—Ç–µ—Ä–∞—Ü–∏—è {counter}----------')
        A_b = A[:, B]
        A_b_inv = np.linalg.inv(A_b)

        #1 –ù–∞—Ö–æ–¥–∏–º –≤–µ–∫—Ç–æ—Ä—ã c(x) u(x) det(x)
        print('–ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—Å—Ç–∏')
        c_x = c + np.dot(x, D)
        c_b = get_basis_vector(c_x, B)
        c_b = [i * (-1) for i in c_b]
        u_x = np.dot(c_b, A_b_inv) # –≤–µ–∫—Ç–æ—Ä –¥–≤–æ–π—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫,
        delta_x = np.dot(u_x, A) + c_x
        print('–í–µ–∫—Ç–æ—Ä —Å(x): ', c_x, sep='')
        print('–í–µ–∫—Ç–æ—Ä u(x): ', u_x, sep='')
        print('–í–µ–∫—Ç–æ—Ä ‚àÜ(x): ', delta_x, sep='')

        #2 –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ–ø–æ—Ä–Ω–æ–≥–æ –ø–ª–∞–Ω–∞.
        # –ï—Å–ª–∏ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–µ–∫—Ç–æ—Ä–∞ ‚àÜ(x) –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ, —Ç–æ –º–µ—Ç–æ–¥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É –∏
        # —Ç–µ–∫—É—â–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ–ø–æ—Ä–Ω—ã–π –ø–ª–∞–Ω —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º.
        j0 = check(delta_x)
        if j0 == -1:
            print('\n–£—Å–ª–æ–≤–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è => –∑–∞–¥–∞—á–∞ —Ä–µ—à–µ–Ω–∞!')
            print('–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –∑–∞–¥–∞—á–∏: ', x, sep='')
            break
        #3 ------------------------------------------------
        print('\n–ù–µ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–µ–∫—Ç–æ—Ä–∞ ‚àÜ(x) –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–∏ÃÜ —à–∞–≥.')
        print('–í—ã–±–∏—Ä–∞–µ–º –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—É—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É –ø–ª–∞–Ω–∞ ‚àÜ(x) –∏ –∏–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–∏ÃÜ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–ø–æ–º–∏–Ω–∞–µ–º –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–∏ÃÜ j0')
        print('–ò–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: ', j0, sep='')
        # –ö –ø–µ—Ä–≤–æ–º—É –∫–ª–∞—Å—Å—É –æ—Ç–Ω–æ—Å—è—Ç—Å—è –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –æ–ø–æ—Ä—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π,
        # –∫–æ –≤—Ç–æ—Ä–æ–º—É ‚Äî –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –Ω–µ –∏–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –æ–ø–æ—Ä—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
        l = np.zeros(len(x))
        l[j0] = 1
        A_b_ext = A[:, Bs]

        H = np.bmat([
            [D[Bs, :][:, Bs], A_b_ext.T],
            [A_b_ext, np.zeros((len(A), len(A)))]
        ])
        H_inv = np.array(np.linalg.inv(H))

        # –û–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π. –°–ø–µ—Ä–≤–∞ –∏–¥—É—Ç —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–æ–ª–±—Ü–∞ –º–∞—Ç—Ä–∏—Ü—ã D —Å –∏–Ω–¥–µ–∫—Å–æ–º j0,
        # —Å—Ç–æ—è—â–∏–µ –≤ —Å—Ç—Ä–æ–∫–∞—Ö —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ Jb* . –î–∞–ª–µ–µ –∏–¥—É—Ç —ç–ª–µ–º–µ–Ω—Ç—ã j0-–≥–æ —Å—Ç–æ–ª–±—Ü–∞ –º–∞—Ç—Ä–∏—Ü—ã A
        b_starred = np.concatenate((D[Bs, j0], A[:, j0]))
        x_temp = np.dot(-H_inv, b_starred)
        l[:len(Bs)] = x_temp[:len(Bs)]
        print('\n–ù–∞—Ö–æ–¥–∏–º  –≤–µ–∫—Ç–æ—Ä l: ', l, sep='')

        #5 –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ j ‚àà Jb* –Ω–∞–π–¥—ë–º –≤–µ–ª–∏—á–∏–Ω—É Œ∏j , –∞ —Ç–∞–∫–∂–µ –≤—ã—á–∏—Å–ª–∏–º –≤–µ–ª–∏—á–∏–Ω—É Œ∏j0
        print('–ù–∞—Ö–æ–¥–∏–º Œò –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –æ–ø–æ—Ä—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π')
        sigma = np.dot(np.dot(l, D), l)
        theta = {}
        theta[j0] = np.inf if sigma == 0 else np.abs(delta_x[j0]) / sigma

        # –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ j ‚àà Jb*  –≤—ã—á–∏—Å–ª–∏–º
        for j in Bs:
            if l[j] < 0:
                theta[j] = -x[j] / l[j]
            else:
                theta[j] = np.inf

        # –ù–∞—Ö–æ–¥–∏–º –º–∏–Ω–∏–º—É–º —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã—Ö Œ∏
        # –∑–∞–ø–æ–º–∏–Ω–∞–µ–º –∏–Ω–¥–µ–∫—Å, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º
        j_s = min(theta, key=theta.get)
        theta_0 = theta[j_s]
        print('–ù–∞–π–¥–µ–Ω–Ω–æ–µ Œò: ', theta, sep='')
        print('Œò –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ: ', theta_0, sep='')
        print('–ò–Ω–¥–µ–∫—Å –º–∏–Ω–∏–º—É–º–∞: ', j_s, sep='')

        # –ï—Å–ª–∏ Œ∏0 = ‚àû, —Ç–æ –º–µ—Ç–æ–¥  –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É —Å –æ—Ç–≤–µ—Ç–æ–º
        print('–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ—Å—Ç–∏ —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏')
        if theta_0 == np.inf:
            print('–§—É–Ω–∫—Ü–∏—è –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø–ª–∞–Ω–æ–≤')

        #6
        print('\n–û–±–Ω–æ–≤–∏–º –¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø–ª–∞–Ω')
        x = x + theta_0 * l
        print('–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø–ª–∞–Ω: ', x, sep='')
        if j_s == j0:
            Bs = np.append(Bs, j_s)
        elif j_s in Bs and j_s not in B:
            Bs = np.delete(Bs, j_s)
        elif j_s in B:
            third_condition = False
            s = B.index(j_s)

        # 1.	–ï—Å–ª–∏ j = j0, —Ç–æ Jb –Ω–µ –º–µ–Ω—è–µ–º, –∞ –≤ Jb* –¥–æ–±–∞–≤–ª—è–µ–º j .
        # 2.	–ï—Å–ª–∏ j ‚àà Jb* \ Jb, —Ç–æ Jb –Ω–µ –º–µ–Ω—è–µ–º, –∞ –∏–∑ Jb*  —É–¥–∞–ª—è–µ–º j .
        #3 3.	–ï—Å–ª–∏ j ‚àà Jb (–∏–Ω–¥–µ–∫—Å j –∏–¥—ë—Ç s-–º –ø–æ —Å—á—ë—Ç—É –≤ Jb) –∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–Ω–¥–µ–∫—Å
        # j+ ‚àà Jb* \ Jb —Ç–∞–∫–æ–π, —á—Ç–æ s-—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤–µ–∫—Ç–æ—Ä–∞ (A‚àí1 ¬∑ Aj) –Ω–µ —Ä–∞–≤–Ω–∞
        # 0, —Ç–æ –≤ Jb –∑–∞–º–µ–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å j –Ω–∞ –∏–Ω–¥–µ–∫—Å j+, –∞ –∏–∑ Jb* —É–¥–∞–ª—è–µ–º –∏–Ω–¥–µ–∫—Å j .
        #4.	–ï—Å–ª–∏ j ‚àà Jb (–∏–Ω–¥–µ–∫—Å j –∏–¥—ë—Ç s-–º –ø–æ —Å—á—ë—Ç—É –≤ Jb) –∏ (Jb = Jb*  –∏–ª–∏ –¥–ª—è –ª—é–±–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ j+ ‚àà Jb* \ Jb
        # –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ª–æ–≤–∏–µ: s-–∞—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤–µ–∫—Ç–æ—Ä–∞ (A‚àí1 ¬∑ Aj –Ω–∞ –∏–Ω–¥–µ–∫—Å j0.

            print('\n–û–±–Ω–æ–≤–ª—è–µ–º –æ–ø–æ—Ä—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π')
            for j_plus in set(Bs).difference(B):
                if (np.dot(A_b_inv, A[:, j_plus]))[s] != 0:
                    third_condition = True
                    B[s] = j_plus
                    Bs = np.delete(Bs, j_s)

            if not third_condition:
                B[s] = j0
                Bs[Bs.index(j_s)] = j0
            print('–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –æ–ø–æ—Ä—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π: ', Bs, sep='')

